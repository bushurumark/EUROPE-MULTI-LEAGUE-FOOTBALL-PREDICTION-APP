# -*- coding: utf-8 -*-
"""main.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1oUaiynHUfX58nNa1pO-SSb0Zp_Vt8Bf1
"""

from fastapi import FastAPI, HTTPException
from pydantic import BaseModel
from typing import Dict
from utils import download_models, load_data, predict_match  # Shared functions
import joblib

app = FastAPI()
# Load models and data once at startup
model1, model2 = download_models()
data1, data2 = load_data()

# Request/Response models
class PredictionRequest(BaseModel):
    home_team: str
    away_team: str
    league_type: str  # "European" or "Others"

class PredictionResponse(BaseModel):
    prediction: str
    probabilities: Dict[str, float]
    model_used: str

@app.post("/predict", response_model=PredictionResponse)
async def predict(request: PredictionRequest):
    try:
        result = predict_match(
            request.home_team,
            request.away_team,
            request.league_type,
            model1, model2, data1, data2
        )
        return result
    except Exception as e:
        raise HTTPException(status_code=400, detail=str(e))