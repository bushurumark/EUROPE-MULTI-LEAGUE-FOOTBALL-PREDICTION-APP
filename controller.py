# -*- coding: utf-8 -*-
"""controller.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1DRHmqRRGvKAsXTRJfHMmDzFbPVNbe5Ke
"""

from model_utils import (
    compute_mean_for_teams,
    calculate_probabilities,
    determine_final_prediction,
    predict_with_confidence,
)
from analytics import (
    get_team_recent_form,
    get_head_to_head_history
)

def run_prediction(home_team, away_team, model, data, version):
    input_data = compute_mean_for_teams(home_team, away_team, data, model, version=version)
    probs = calculate_probabilities(home_team, away_team, data, version=version)

    if input_data is None or probs is None:
        return None, None, None, None, None, None

    pred = model.predict(input_data)[0]
    final = determine_final_prediction(pred, probs)
    pred_label, pred_conf, full_conf = predict_with_confidence(model, input_data)

    home_form = get_team_recent_form(home_team, data, version=version)
    away_form = get_team_recent_form(away_team, data, version=version)
    head_to_head = get_head_to_head_history(home_team, away_team, data, version=version)

    return final, full_conf, probs, home_form, away_form, head_to_head